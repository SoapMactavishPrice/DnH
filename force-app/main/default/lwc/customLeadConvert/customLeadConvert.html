<template>

	<!-- <div style="width: 80vw; max-width: 1200px;"> -->

	<div if:true={showSpinner}>
		<lightning-spinner variant="brand" alternative-text="Loading" size="medium"></lightning-spinner>
	</div>

	<lightning-modal-header label={modalHeader}></lightning-modal-header>

	<lightning-modal-body class="modal-body">
		<div>
			<lightning-card if:true={leadRecord} variant=" narrow">
				<lightning-layout multiple-rows horizontal-align="spread" pull-to-boundary="small"
					vertical-align="stretch" class="slds-var-m-around_small layout-body slds-box">
					<lightning-layout-item class="col1">
						<div class="slds-text-heading_small">Account</div>
					</lightning-layout-item>

					<lightning-layout-item class="col2">
						<div class="slds-text-heading_small" style="width: 255px !important;">
							<span class="slds-radio">
								<input type="radio" class="create-new-existing-radio" id="acc-create-new" name="Account"
									value="AccountCreateNew" onclick={decideRequiredOrNot} checked />
								<label class="slds-radio__label" for="acc-create-new">
									<span class="slds-radio_faux"></span>
									<span class="slds-form-element__label slds-text-title_bold">Create New</span>
								</label>
							</span>
						</div>

						<template if:true={isNewAccountFlag}>
							<div class="create-record-form slds-box slds-var-m-top_small"
								style="width: 255px !important;">
								<lightning-input class="account-fields" name="accountName" label="Account Name"
									value={accountName} onchange={handleValueChange} required={AccountCreateNewName}
									lwc:ref="accountNameRef">
								</lightning-input>
								<lightning-input type="checkbox" label="Is Direct Customer?"
									class="slds-m-top_medium slds-m-bottom_small" checked={isDirectCustomerChecked}
									onchange={handleIsDirectCustomerCheck}>
								</lightning-input>
								<template if:false={isDirectCustomerChecked}>
									<lightning-record-edit-form object-api-name="Lead__c">
										<lightning-input-field field-name="Dealer__c" value={dealerValue}
											variant="standard" class="slds-m-top_small" data-id="dealerField">
										</lightning-input-field>
									</lightning-record-edit-form>
								</template>
								<!-- "-->

								<!--
								<lightning-combobox class="account-fields" name="accountRecordType" label="Record Type" value={accountRecordType}
									placeholder="Select Record Type" options={accRecordTypes} onchange={handleValueChange} required={AccountCreateNewRT}
									lwc:ref="accountRTRef"></lightning-combobox>    lwc:ref="accountNameRef"-->
							</div>
						</template>

					</lightning-layout-item>

					<template if:true={is_Account_OR}>
						<lightning-layout-item class="col3">
							<div class="separator-container">
								<div class="slds-text-align_center" style="padding-top: 50px;">- OR -</div>
								<div class="vertical-line"></div>
							</div>
						</lightning-layout-item>
					</template>

					<lightning-layout-item class="col4">
						<div class="slds-text-heading_small" style="width: 255px !important;">
							<span class="slds-radio">
								<input type="radio" class="create-new-existing-radio account-radio"
									id="acc-create-existing" name="Account" value="AccountExisting"
									onclick={decideRequiredOrNot} />
								<label class="slds-radio__label" for="acc-create-existing">
									<span class="slds-radio_faux"></span>
									<span class="slds-form-element__label slds-text-title_bold">Choose Existing</span>
								</label>
							</span>
						</div>

						<template if:true={isExistingAccountFlag}>
							<div class="create-record-form existing-account-lookup slds-box slds-var-m-top_small"
								style="width: 255px !important;">
								<label class="slds-form-element__label" style="padding-bottom: 0px !important;">Search
									Account</label>
								<c-enhanced-custom-lookup if:true={refreshSelectedAccountId} object-api-name="Account"
									icon-name="standard:account" default-record-id={selectedAccountId} return-fields=""
									sort-column="Name" display-fields="" query-fields="['Name']"
									onrecordselection={handleExistingAccountSelect}></c-enhanced-custom-lookup>
								<c-enhanced-custom-lookup if:false={refreshSelectedAccountId} object-api-name="Account"
									icon-name="standard:account" default-record-id={selectedAccountId} return-fields=""
									sort-column="Name" display-fields="" query-fields="['Name']"
									onrecordselection={handleExistingAccountSelect}></c-enhanced-custom-lookup>
								<div if:true={AccountExistingShowError} class="custom_error_container">
									Please choose an existing Account or create a new one.
								</div>
							</div>
						</template>

					</lightning-layout-item>
				</lightning-layout>

				<lightning-layout multiple-rows horizontal-align="spread" pull-to-boundary="small"
					vertical-align="stretch" class="slds-var-m-around_small layout-body slds-box">
					<lightning-layout-item class="col1">
						<div class="slds-text-heading_small">Contact</div>
					</lightning-layout-item>

					<lightning-layout-item class="col2">

						<div class="slds-text-heading_small" style="width: 255px !important;">
							<span class="slds-radio">
								<input type="radio" class="create-new-existing-radio contact-radio" id="cont-create-new"
									name="Contact" value="ContactCreateNew" onclick={decideRequiredOrNot} checked />
								<label class="slds-radio__label" for="cont-create-new">
									<span class="slds-radio_faux"></span>
									<span class="slds-form-element__label slds-text-title_bold">Create New</span>
								</label>
							</span>
						</div>

						<template if:true={isNewContactFlag}>
							<div class="create-record-form slds-box slds-var-m-top_small"
								style="width: 255px !important;">
								<lightning-input-name name="ContactName" label="Contact Name"
									first-name={leadRecord.First_Name__c} middle-name={leadRecord.Middle_Name__c}
									last-name={leadRecord.Last_Name__c} salutation={leadRecord.Salutation__c}
									options={salutationOptions} fields-to-display={fieldList}
									onchange={handleValueChange} required={ContactCreateNew}
									lwc:ref="contactNameRef"></lightning-input-name>
							</div>
						</template>
					</lightning-layout-item>

					<template if:true={is_Contact_OR}>
						<lightning-layout-item class="col3">
							<div class="separator-container">
								<div class="slds-text-align_center" style="padding-top: 50px;">- OR -</div>
								<div class="vertical-line"></div>
							</div>
						</lightning-layout-item>
					</template>

					<lightning-layout-item class="col4 contact-select-existing" aria-describedby="help">
						<div if:true={AccountCreateNew} class="disabledContactTooltip">
							<div class="slds-popover slds-popover_tooltip slds-nubbin_top-left" role="tooltip" id="help"
								style="position: absolute; margin-left: 5%; margin-top: 10%">
								<div class="slds-popover__body">
									Available only if existing account is selected
								</div>
							</div>
						</div>
						<div>
							<div class="slds-text-heading_small" style="width: 255px !important;">
								<span class="slds-radio">
									<input type="radio" class="create-new-existing-radio contact-radio"
										id="cont-create-existing" name="Contact" value="ContactExisting"
										onclick={decideRequiredOrNot} disabled={AccountCreateNew} />
									<label class="slds-radio__label" for="cont-create-existing">
										<span class="slds-radio_faux"></span>
										<span class="slds-form-element__label slds-text-title_bold">Choose
											Existing</span>
									</label>
								</span>
							</div>

							<template if:true={isExistingContactFlag}>
								<div class="create-record-form slds-box slds-var-m-top_small"
									style="width: 255px !important;">
									<label class="slds-form-element__label"
										style="padding-bottom: 0px !important;">Search
										Contact</label>
									<c-enhanced-custom-lookup if:true={refreshSelectedContactId}
										style="width: 92%; display: inline-block" object-api-name="Contact"
										icon-name="standard:contact" default-record-id={selectedContactId}
										return-fields="" sort-column="Name" display-fields="" query-fields="['Name']"
										filter={contactExistingFilter} onrecordselection={handleExistingContactSelect}
										disabled={AccountCreateNew}></c-enhanced-custom-lookup>
									<c-enhanced-custom-lookup if:false={refreshSelectedContactId}
										style="width: 92%; display: inline-block" object-api-name="Contact"
										icon-name="standard:contact" default-record-id={selectedContactId}
										return-fields="" sort-column="Name" display-fields="" query-fields="['Name']"
										filter={contactExistingFilter} onrecordselection={handleExistingContactSelect}
										disabled={AccountCreateNew}></c-enhanced-custom-lookup>
									<lightning-helptext style="width: 8%; text-align: right; display: inline-grid"
										content="When selected, existing contact data will be overwritten"></lightning-helptext>
									<!-- transform: scale(1.5) -->
								</div>
								<div if:true={ContactExistingShowError} class="custom_error_container">
									Please choose an existing contact or create a new
									one.
								</div>
							</template>
						</div>
					</lightning-layout-item>
				</lightning-layout>

				<lightning-layout multiple-rows horizontal-align="spread" pull-to-boundary="small"
					vertical-align="stretch" class="slds-var-m-around_small layout-body slds-box"
					style="justify-content: left !important;">
					<lightning-layout-item class="col1" style="margin-right: 86px !important;">
						<div class="slds-text-heading_small">Enquiry</div>
					</lightning-layout-item>

					<lightning-layout-item class="col2" style="margin-left:0%;">
						<div class="slds-text-heading_small" style="width: 255px !important;">
							<span class="slds-radio">
								<input type="radio" class="create-new-existing-radio" id="opp-create-new"
									name="Opportunity" value="OpportunityCreateNew" onclick={decideRequiredOrNot}
									checked />
								<label class="slds-radio__label" for="opp-create-new">
									<span class="slds-radio_faux"></span>
									<span class="slds-form-element__label slds-text-title_bold">Create New</span>
								</label>
							</span>
						</div>

						<template if:true={isNewEnquiryFlag}>
							<div class="create-record-form slds-box slds-var-m-top_small"
								style="width: 255px !important;">
								<lightning-input class="opportunity-fields" label="Enquiry Name" name="opportunityName"
									value={opportunityName} onchange={handleValueChange}
									required={OpportunityCreateNewName} lwc:ref="opportunityNameRef"></lightning-input>
								<lightning-input type="checkbox" label="Don't create an opportunity upon conversion"
									class="slds-m-top_medium" data-name-invcheck="createEnquiryCheckbox"
									checked={isCreateEnquiryChecked} onchange={handleisCreateEnquiryCheck}>
								</lightning-input>
							</div>
							<lightning-combobox label="Select Enquiry Record Type" value={selectedRecordTypeId}
								placeholder="Select record type" options={recordTypeOptions}
								onchange={handleRecordTypeChange}>
							</lightning-combobox>
						</template>
					</lightning-layout-item>

					<!-- <template if:true={is_Enquiry_OR}>
						<lightning-layout-item class="col3">
							<div class="separator-container">
								<div class="slds-text-align_center" style="padding-top: 50px;">- OR -</div>
								<div class="vertical-line"></div>
							</div>
						</lightning-layout-item>
					</template>

					<lightning-layout-item class="col4" style="cursor: not-allowed">
						<div class="slds-text-heading_small" style="width: 255px !important;">
							<span class="slds-radio">
								<input type="radio" class="create-new-existing-radio" id="opp-create-existing" name="Opportunity"
									lwc:ref="OpportunityExisting" onclick={decideRequiredOrNot} disabled />
								<label class="slds-radio__label" for="opp-create-existing">
									<span class="slds-radio_faux"></span>
									<span class="slds-form-element__label slds-text-title_bold">Choose
										Existing</span>
								</label>
							</span>
						</div>

						<template if:true={isExistingEnquiryFlag}>
							<div class="create-record-form slds-box slds-var-m-top_small" style="width: 255px !important;">
								<label class="slds-form-element__label" style="padding-bottom: 0px !important;">Search
									Enquiry</label>
								<c-enhanced-custom-lookup if:true={refreshSelectedOpportunityId} object-api-name="Enquiry__c"
									icon-name="standard:opportunity" default-record-id={selectedOpportunityId} return-fields=""
									sort-column="Name" display-fields="" query-fields="['Name']"
									onrecordselection={handleExistingOpportunitySelect} disabled="true"></c-enhanced-custom-lookup>
								<c-enhanced-custom-lookup if:false={refreshSelectedOpportunityId} object-api-name="Enquiry__c"
									icon-name="standard:opportunity" default-record-id={selectedOpportunityId} return-fields=""
									sort-column="Name" display-fields="" query-fields="['Name']"
									onrecordselection={handleExistingOpportunitySelect} disabled="true"></c-enhanced-custom-lookup>
								<div if:true={OpportunityExistingShowError} class="custom_error_container">
									Please choose an existing customer or create a new
									one.
								</div>
							</div>
						</template>
					</lightning-layout-item> -->
				</lightning-layout>
			</lightning-card>

			<!--
            <lightning-card variant="narrow">
                <h3 slot="title" class="slds-var-p-top_small">
                   comm <lightning-icon icon-name="action:lead_convert" size="small"></lightning-icon> comm
                    Existing Accounts
                </h3>

                <div>
                    comm slds-var-m-bottom_xx-large slds-var-p-bottom_xx-large comm
                    <lightning-layout multiple-rows>
                        <lightning-layout-item padding="around-small" size="12" small-device-size="6" medium-device-size="3" large-device-size="3">
                            <lightning-combobox if:true={showExistingAccountsSection} options={pageSizeOptions} label="Page Size : " name="PageSize"
                                value={pageSize} onchange={handleValueChange}></lightning-combobox>
                        </lightning-layout-item>
                        <lightning-layout-item padding="around-small" size="12" small-device-size="6" medium-device-size="6" large-device-size="6">
                            <lightning-input if:true={showExistingAccountsSection} name="Search" label="Search" placeholder="Search ..." type="search"
                                onchange={handleValueChange}>
                            </lightning-input>
                        </lightning-layout-item>
                        <lightning-layout-item padding="around-small" size="12" small-device-size="12" medium-device-size="3" large-device-size="3">
                            <lightning-input type="text" name="PinCode" label="Zip/Postal Code" value={pinCode}
                                onchange={handleValueChange}></lightning-input>
                        </lightning-layout-item>
                    </lightning-layout>

                    <div if:true={showExistingAccountsSection}>
                        comm sldsValidatorIgnoreNextLine comm
                        <lightning-datatable key-field="Id" columns={columns} data={recordsToDisplay} onrowselection={handleRowSelection}
                            max-row-selection="1" show-checkbox-column></lightning-datatable>
                        comm default-sort-direction={sortDirection} sorted-direction={sortDirection} sorted-by={sortedBy} onsort={onHandleSort} comm

                        <div if:true={showExistingAccountsSection} style="
                            margin: auto;
                            text-align: center;
                            display: flex;
                            justify-content: center;
                        ">
                            <lightning-button style="margin: 1%" variant="brand" icon-name="utility:back" label="Prev" onclick={previousPage}
                                disabled={bDisableFirst}></lightning-button>
                            <div style="
                                border-radius: 5px;
                                border: 1px solid gray;
                                margin: 1%;
                                padding: 0.4% 1%;
                            ">
                                comm {start} - {end} of {totalRecords} | page {pageNumber} of {totalPages} comm
                                Showing {pageNumber} of {totalPages}
                            </div>
                            <lightning-button style="margin: 1%" variant="brand" icon-name="utility:forward" icon-position="right" label="Next"
                                onclick={nextPage} disabled={bDisableLast}></lightning-button>
                        </div>
                    </div>
                </div>
            </lightning-card>-->
		</div>
	</lightning-modal-body>

	<lightning-modal-footer>
		<!--
            <div style="width: 5%" class="slds-align_absolute-center">
                <lightning-icon icon-name="utility:error" variant="error" size="small" onclick={handleShowError}
                    class="show-error"></lightning-icon>
            </div>
-->
		<div>
			<lightning-button label="Cancel" name="Cancel" onclick={closeComponent}
				class="slds-var-m-right_small"></lightning-button>
			<lightning-button variant="brand" label="Convert" name="Convert" onclick={handleConfirmClick}
				class="slds-var-m-left_small"></lightning-button>
		</div>
	</lightning-modal-footer>



	<!--
    <div role="dialog" class="popover slds-popover slds-popover_error slds-nubbin_bottom-left"
        style="display: block; position: absolute">
        <div class="popover-header slds-var-p-around_medium">
            <lightning-icon icon-name=" utility:error" variant="inverse" size="x-small">
            </lightning-icon>
            <div class="slds-var-p-horizontal_small">We hit a snag.</div>
            <lightning-icon icon-name="utility:close" variant="inverse" size="x-small"
                onclick={handleShowErrorClose}></lightning-icon>
        </div>

        <div class="popover-body slds-var-p-horizontal_small slds-var-p-top_xx-small slds-var-p-bottom_medium slds-scrollable_y"
            style="max-height: 200px">
            <div>{errorMessage}</div>
        </div>
    </div>
-->
	<!-- </div> -->
</template>