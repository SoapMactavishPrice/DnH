<template>
    <lightning-card variant="base">
        <!-- <div slot="title">
          Card Title
      </div>
      <div slot="actions">
    
      </div>
      <div slot="footer">
    
      </div> -->
        <div>
            <lightning-layout multiple-rows>
                <lightning-layout-item size="12" medium-device-size="6" large-device-size="3"
                    class="slds-p-around_medium">
                    <lightning-input label="Current Fiscal Year" type="text" value={currentFiscalYearName} disabled>
                    </lightning-input>
                </lightning-layout-item>

                <lightning-layout-item size="12" medium-device-size="6" large-device-size="3"
                    class="slds-p-around_medium">
                    <lightning-combobox label="Month" value={monthValue} options={monthOptions}
                        onchange={handleMonthChange}>
                    </lightning-combobox>
                </lightning-layout-item>
            </lightning-layout>

            <div>
                <table class="slds-table slds-table_cell-buffer slds-table_bordered custom-table">
                    <thead>
                        <tr>
                            <th class="slds-text-align_center" scope="col">Customer Name</th>
                            <th class="slds-text-align_center" scope="col">Sales Order No</th>
                            <th class="slds-text-align_center" scope="col">Item Name</th>
                            <th class="slds-text-align_center" scope="col">Net Invoice value</th>
                            <th class="slds-text-align_center" scope="col">Quantity</th>
                            <th class="slds-text-align_center" scope="col">Action</th>
                        </tr>
                    </thead>
                    <tbody>
                        <template for:each={salesRegisterObjects} for:item="salesRegister">
                            <tr key={salesRegister.id}>
                                <td class="slds-text-align_center">{salesRegister.customerName}</td>
                                <td class="slds-text-align_center">{salesRegister.salesOrderNo}</td>
                                <td if:false={salesRegister.itemNoName} class="slds-text-align_center"></td>
                                <td if:true={salesRegister.itemNoName} class="slds-text-align_center">
                                    {salesRegister.itemNoName}</td>
                                <td class="slds-text-align_center">{salesRegister.netInvoiceValue}</td>
                                <td class="slds-text-align_center">{salesRegister.quantity}</td>
                                <!-- <td class="slds-text-align_left">
                                    <c-lookup-component object-api-name="Account" icon-name="standard:account" default-record-id={salesRegister.id}
                                        rowid={salesRegister.id} index={salesRegister.id} index_x={salesRegister.id}
                                        return-fields="Customer_Type__c" sort-column="Name" display-fields=""
                                        query-fields="['Name']" onrecordselection={handleAccountChange}
                                        onfocus={handleAccountChange}>
                                    </c-lookup-component>
                                </td> -->
                                <td class="slds-text-align_center">
                                    <lightning-button-icon icon-name="utility:add" alternative-text="Add" data-parent={salesRegister.id}
                                        onclick={addLineItem} data-index={salesRegister.index}>
                                    </lightning-button-icon>
                                </td>
                            </tr>

                            <template if:true={salesRegister.lineItems}>
                                <tr key={salesRegister.key}>
                                    <th></th>
                                    <th></th>
                                    <th class="slds-text-align_center" scope="col" style="font-weight: bold;">End Customer</th>
                                    <th class="slds-text-align_center" scope="col" style="font-weight: bold;">Net Invoice</th>
                                    <th class="slds-text-align_center" scope="col" style="font-weight: bold;">Quantity</th>
                                    <th class="slds-text-align_center" scope="col" style="font-weight: bold;">Action</th>
                                </tr>
                                <template for:each={salesRegister.lineItems} for:item="eachLineItem">
                                    <tr key={eachLineItem.tempId}>
                                        <td></td>
                                        <td></td>
                                        <td class="slds-text-align_center">
                                            <c-lookup-component object-api-name="Account" icon-name="standard:account" default-record-id={eachLineItem.endCustomer} 
                                                rowid={salesRegister.id} index={salesRegister.id} index_x={salesRegister.id} temp-id={eachLineItem.tempId}
                                                return-fields="Customer_Type__c" sort-column="Name" display-fields=""
                                                query-fields="['Name']" onrecordselection={handleAccountChange}
                                                onfocus={handleAccountChange}>
                                            </c-lookup-component>
                                        </td>
                                        <td class="slds-text-align_center">
                                            <lightning-input type="number" value={eachLineItem.netInvoiceValue} data-field="netInvoiceValue" data-tempid={eachLineItem.tempId} data-parent={salesRegister.id} variant="label-hidden" disabled></lightning-input>
                                        </td>
                                        <td class="slds-text-align_center">
                                            <lightning-input type="number" value={eachLineItem.quantity} onchange={handleLineItemChanges} data-field="quantity" data-tempid={eachLineItem.tempId} data-parent={salesRegister.id} variant="label-hidden"></lightning-input>
                                        </td>
                                        <td class="slds-text-align_center">
                                            <lightning-button-icon icon-name="utility:delete" alternative-text="Delete" data-parent={salesRegister.id}
                                                onclick={removeLineItem} data-index={eachLineItem.index} data-tempid={eachLineItem.tempId} disabled={eachLineItem.isOld}>
                                            </lightning-button-icon>
                                        </td>
                                    </tr>
                                </template>
                            </template>
                        </template>
                    </tbody>
                </table>
            </div>

            <template if:true={srdFlag}>
                <lightning-layout>
                    <lightning-layout-item size="12" class="slds-p-around_medium slds-text-align_center">
                        <lightning-button variant="brand" label="Save" title="Save"
                            onclick={saveLineItem} disabled={isSaveDisabled}>
                        </lightning-button>
                    </lightning-layout-item>
                </lightning-layout>
            </template>
        </div>
    </lightning-card>
</template>